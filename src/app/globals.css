@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* Fixed header height (Header.tsx -> h-14) */
    --app-header-height: 3.5rem;
    --background: 222 84% 5%;
    --foreground: 210 40% 98%;
    --card: 226 50% 12%;
    --card-foreground: 210 40% 98%;
    --popover: 222 84% 5%;
    --popover-foreground: 210 40% 98%;
    --primary: 217 91% 60%;
    --primary-foreground: 210 40% 98%;
    --secondary: 217 33% 17%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217 33% 17%;
    --muted-foreground: 215 20% 65%;
    --accent: 217 91% 60%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 63% 31%;
    --destructive-foreground: 210 40% 98%;
    --border: 217 33% 17%;
    --input: 217 33% 17%;
    --ring: 217 91% 60%;
    --radius: 0.5rem;

    --status-priority: 45 100% 50%;
    --status-not-registered: 262 88% 58%;
    --status-collected: 172 66% 16%;
    --status-collected-border: 158 64% 52%;
    --status-collected-foreground: 210 40% 98%;
    --status-collected-button: 148 83% 47%;
    --status-sc: 140 80% 60%;
    --status-gc: 45 100% 60%;

    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
  }

  .dark {
    /* Keep a copy in dark scope for clarity (same value) */
    --app-header-height: 3.5rem;
    --background: 222 84% 5%;
    --foreground: 210 40% 98%;
    --card: 226 50% 12%;
    --card-foreground: 210 40% 98%;
    --popover: 222 84% 5%;
    --popover-foreground: 210 40% 98%;
    --primary: 217 91% 60%;
    --primary-foreground: 210 40% 98%;
    --secondary: 217 33% 17%;
    --secondary-foreground: 210 40% 98%;
    --muted: 217 33% 17%;
    --muted-foreground: 215 20% 65%;
    --accent: 217 91% 60%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 63% 31%;
    --destructive-foreground: 210 40% 98%;
    --border: 217 33% 17%;
    --input: 217 33% 17%;
    --ring: 217 91% 60%;
    
    --status-priority: 45 100% 50%;
    --status-not-registered: 262 88% 58%;
    --status-collected: 172 66% 16%;
    --status-collected-border: 158 64% 52%;
    --status-collected-foreground: 210 40% 98%;
    --status-collected-button: 148 83% 47%;
    --status-sc: 140 80% 60%;
    --status-gc: 45 100% 60%;
  }
}

@layer base {
  html { overflow-x: hidden; }
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground overflow-x-hidden;
    /* Sitewide dark, foggy gradient backdrop */
    background-color: hsl(var(--background));
    background-image:
      radial-gradient(1200px 800px at -10% -10%, hsl(0 0% 0% / 0.55), transparent 60%),
      radial-gradient(900px 700px at 15% 25%, hsl(0 0% 0% / 0.35), transparent 55%),
      radial-gradient(1000px 700px at 110% 0%, hsl(0 0% 0% / 0.45), transparent 60%),
      radial-gradient(800px 600px at 0% 105%, hsl(0 0% 0% / 0.55), transparent 60%),
      radial-gradient(900px 600px at 100% 100%, hsl(0 0% 0% / 0.60), transparent 60%),
      /* subtle brand tint */
      radial-gradient(900px 650px at 75% 20%, hsl(var(--primary) / 0.10), transparent 60%),
      radial-gradient(800px 600px at 25% 80%, hsl(var(--primary) / 0.07), transparent 60%);
    background-repeat: no-repeat;
    background-attachment: fixed;
    background-size: auto;
  }
}

/* Mobile: avoid iOS issues with fixed backgrounds blocking scroll */
@media (max-width: 768px) {
  body { background-attachment: scroll; }
}

/* iOS Safari specific safeguard */
@supports (-webkit-touch-callout: none) {
  body { background-attachment: scroll; }
}

/* Generic helpers for layouts with fixed header */
@layer utilities {
  /* Adds top padding equal to header height so content doesn't hide under fixed header */
  .under-header {
    padding-top: var(--app-header-height);
  }

  /* Ensures the primary content area can fill the viewport below the header */
  .admin-fit {
    min-height: calc(100dvh - var(--app-header-height));
  }
}

@layer utilities {
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
  /* Sticky element that stays just under the fixed header within scrollable <main> */
  .sticky-under-header {
    position: sticky;
    top: 0; /* works with .under-header padding on the scroll container */
    z-index: 20;
  }

  /* Second sticky row that sits right under the SectionHeader */
  .sticky-under-header-2 {
    position: sticky;
    top: 6.5rem; /* approximate header block height */
    z-index: 19;
  }
}

/* Animated conic-gradient border that rotates like a snake */
@layer utilities {
  .animated-border { position: relative; --ab-angle: 0deg; --ab-delay: 0s; }
  .animated-border::before {
    content: ""; position: absolute; inset: -1px; padding: 1px; border-radius: inherit;
    background: conic-gradient(from var(--ab-angle), rgba(59,130,246,0) 0deg, rgba(59,130,246,0.85) 60deg, rgba(59,130,246,0) 120deg, rgba(59,130,246,0) 360deg);
    -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
    -webkit-mask-composite: xor; mask-composite: exclude; pointer-events: none;
    animation: ab-rotate 6s linear infinite; animation-delay: var(--ab-delay);
  }
  @keyframes ab-rotate { to { --ab-angle: 360deg; } }
}


/* NProgress styles */
#nprogress {
  pointer-events: none;
}

#nprogress .bar {
  background: hsl(var(--primary));
  position: fixed;
  z-index: 1031;
  top: 0;
  left: 0;
  width: 100%;
  height: 3px;
}

#nprogress .peg {
  display: block;
  position: absolute;
  right: 0px;
  width: 100px;
  height: 100%;
  box-shadow: 0 0 10px hsl(var(--primary)), 0 0 5px hsl(var(--primary));
  opacity: 1.0;
  transform: rotate(3deg) translate(0px, -4px);
}

.shine-effect {
  animation: shine-animation 4s infinite linear;
}

@keyframes shine-animation {
  0% { transform: translateX(-150%) skewX(-30deg); }
  100% { transform: translateX(150%) skewX(-30deg); }
}

/* sweep-drop loader (animated clipping boxes) */
.sd-loader {
  width: 200px;
  height: 200px;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.sd-box-wrap {
  width: 70%;
  height: 70%;
  margin: calc((100% - 70%) / 2) auto;
  position: relative;
  transform: rotate(-45deg);
}
.sd-box {
  width: 100%;
  height: 100%;
  position: absolute;
  left: 0;
  top: 0;
  background: linear-gradient(
    90deg,
    hsl(var(--primary)) 0%,
    hsl(var(--primary) / 0.8) 30%,
    hsl(0 0% 100% / 0.7) 60%,
    hsl(var(--primary) / 0.8) 85%,
    hsl(var(--primary)) 100%
  );
  background-position: 0% 50%;
  background-size: 1000% 1000%;
  visibility: hidden;
  border-radius: 8px;
}
.sd-box.one { animation: sd-moveGradient 15s infinite, sd-oneMove 3.5s infinite; }
.sd-box.two { animation: sd-moveGradient 15s infinite, sd-twoMove 3.5s .15s infinite; }
.sd-box.three { animation: sd-moveGradient 15s infinite, sd-threeMove 3.5s .3s infinite; }
.sd-box.four { animation: sd-moveGradient 15s infinite, sd-fourMove 3.5s .575s infinite; }
.sd-box.five { animation: sd-moveGradient 15s infinite, sd-fiveMove 3.5s .725s infinite; }
.sd-box.six { animation: sd-moveGradient 15s infinite, sd-sixMove 3.5s .875s infinite; }

@keyframes sd-moveGradient { to { background-position: 100% 50% } }

@keyframes sd-oneMove {
  0% { visibility: visible; clip-path: inset(0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  14.2857% { clip-path: inset(0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  28.5714% { clip-path: inset(35% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  42.8571% { clip-path: inset(35% 70% 35% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  57.1428% { clip-path: inset(35% 70% 35% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  71.4285% { clip-path: inset(0% 70% 70% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  85.7142% { clip-path: inset(0% 70% 70% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  100% { clip-path: inset(0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
}

@keyframes sd-twoMove {
  0% { visibility: visible; clip-path: inset(0% 70% 70% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  14.2857% { clip-path: inset(0% 70% 70% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  28.5714% { clip-path: inset(0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  42.8571% { clip-path: inset(0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  57.1428% { clip-path: inset(35% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  71.4285% { clip-path: inset(35% 70% 35% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  85.7142% { clip-path: inset(35% 70% 35% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  100% { clip-path: inset(0% 70% 70% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
}

@keyframes sd-threeMove {
  0% { visibility: visible; clip-path: inset(35% 70% 35% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  14.2857% { clip-path: inset(35% 70% 35% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  28.5714% { clip-path: inset(0% 70% 70% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  42.8571% { clip-path: inset(0% 70% 70% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  57.1428% { clip-path: inset(0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  71.4285% { clip-path: inset(0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  85.7142% { clip-path: inset(35% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  100% { clip-path: inset(35% 70% 35% 0 round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
}

@keyframes sd-fourMove {
  0% { visibility: visible; clip-path: inset(35% 0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  14.2857% { clip-path: inset(35% 0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  28.5714% { clip-path: inset(35% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  42.8571% { clip-path: inset(70% 35% 0% 35% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  57.1428% { clip-path: inset(70% 35% 0% 35% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  71.4285% { clip-path: inset(70% 0 0 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  85.7142% { clip-path: inset(70% 0 0 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  100% { clip-path: inset(35% 0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
}

@keyframes sd-fiveMove {
  0% { visibility: visible; clip-path: inset(70% 0 0 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  14.2857% { clip-path: inset(70% 0 0 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  28.5714% { clip-path: inset(35% 0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  42.8571% { clip-path: inset(35% 0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  57.1428% { clip-path: inset(35% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  71.4285% { clip-path: inset(70% 35% 0% 35% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  85.7142% { clip-path: inset(70% 35% 0% 35% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  100% { clip-path: inset(70% 0 0 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
}

@keyframes sd-sixMove {
  0% { visibility: visible; clip-path: inset(70% 35% 0% 35% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  14.2857% { clip-path: inset(70% 35% 0% 35% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  28.5714% { clip-path: inset(70% 0 0 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  42.8571% { clip-path: inset(70% 0 0 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  57.1428% { clip-path: inset(35% 0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  71.4285% { clip-path: inset(35% 0% 35% 70% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  85.7142% { clip-path: inset(35% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
  100% { clip-path: inset(70% 35% 0% 35% round 5%); animation-timing-function: cubic-bezier(0.86,0,0.07,1) }
}

/* gentle animated fog for login */
.fog-bg {
  background-image:
    radial-gradient(700px 500px at 10% 10%, hsl(var(--primary) / 0.12), transparent 60%),
    radial-gradient(800px 600px at 90% 0%, hsl(0 0% 0% / 0.38), transparent 60%),
    radial-gradient(900px 650px at 0% 100%, hsl(var(--primary) / 0.10), transparent 60%),
    radial-gradient(800px 600px at 100% 100%, hsl(0 0% 0% / 0.4), transparent 60%);
  background-size: 140% 140%, 160% 160%, 150% 150%, 160% 160%;
  animation: fog-move 26s ease-in-out infinite alternate;
}

/* Stack loader (3D rotating cards) */
.stack {
  --stack-dur: 2s;
  --stack-delay: 0.05;
  --stack-spacing: 15%;
  position: relative;
  width: 14em;
  height: 32em;
  perspective: 800px;
}
.stack__card {
  aspect-ratio: 1 / 1;
  position: absolute;
  inset: 0;
  top: var(--stack-spacing);
  margin: auto;
  width: 70%;
  transform: rotateX(45deg) rotateZ(-45deg);
  transform-style: preserve-3d;
}
.stack__card::before {
  animation: stack-card var(--stack-dur) infinite;
  background-color: hsl(var(--primary) / 0.55);
  border-radius: 10px;
  box-shadow: -0.5em 0.5em 1.5em hsl(0 0% 0% / 0.15);
  content: "";
  position: absolute;
  inset: 0;
}
.stack__card:nth-child(2) { top: 0 }
.stack__card:nth-child(2)::before {
  animation-delay: calc(var(--stack-dur) * (-1 + var(--stack-delay)));
  background-color: hsl(var(--primary) / 0.35);
}
.stack__card:nth-child(3) { top: calc(var(--stack-spacing) * -1) }
.stack__card:nth-child(3)::before {
  animation-delay: calc(var(--stack-dur) * (-1 + var(--stack-delay) * 2));
  background-color: hsl(var(--primary) / 0.15);
}

@keyframes stack-card {
  0%, 100% { transform: translateZ(0); opacity: 1; }
  11% { transform: translateZ(0.5em); opacity: 1; }
  34% { transform: translateZ(-12em); opacity: 0; }
  48% { transform: translateZ(12em); opacity: 0; }
  57% { transform: translateZ(0); opacity: 1; }
  61% { transform: translateZ(-1.8em); }
  74% { transform: translateZ(0.6em); }
  87% { transform: translateZ(-0.2em); }
}

@keyframes fog-move {
  0% { background-position: 0% 0%, 100% 0%, 0% 100%, 100% 100%; }
  50% { background-position: 15% 5%, 85% 10%, 10% 90%, 90% 95%; }
  100% { background-position: 0% 0%, 100% 0%, 0% 100%, 100% 100%; }
}

/* Animated CTA button in sweeps style */
.cta-sweeps {
  --cta-radius: 14px;
  --cta-shadow: 0 12px 28px rgba(0,0,0,0.35), 0 0 18px rgba(245,158,11,0.22);
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 12px 18px;
  border-radius: var(--cta-radius);
  border: 1px solid rgba(255,255,255,0.14);
  color: #0b0b0f;
  font-weight: 700;
  letter-spacing: 0.01em;
  text-decoration: none;
  overflow: hidden; /* keep effects inside the button */
  background-image: linear-gradient(90deg,#22C55E 0%,#86EFAC 25%,#FDE047 55%,#F59E0B 75%,#22C55E 100%);
  background-size: 200% 200%;
  animation: cta-move 6s ease-in-out infinite;
  box-shadow: var(--cta-shadow);
  transform: translateZ(0); /* better perf */
}
.cta-sweeps:hover { transform: translateY(-2px); box-shadow: 0 18px 40px rgba(0,0,0,0.45), 0 0 26px rgba(245,158,11,0.32); }
.cta-sweeps:active { transform: translateY(0); }
.cta-sweeps::after {
  content: "";
  position: absolute; inset: 0; border-radius: inherit; pointer-events: none;
  background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,0.16), rgba(255,255,255,0));
  width: 32%; height: 100%; transform: skewX(16deg) translateX(-140%);
  animation: cta-shine 2.8s cubic-bezier(.4,0,.2,1) infinite;
}
.cta-sweeps .icon { transition: transform .25s ease; }
.cta-sweeps:hover .icon { transform: translateX(2px); }

@keyframes cta-move { 0%{ background-position: 0% 50% } 50%{ background-position: 100% 50% } 100%{ background-position: 0% 50% } }
@keyframes cta-shine { 0%{ transform: skewX(16deg) translateX(-140%); opacity: 0 }
  15%{ opacity: .9 } 40%{ opacity: .6 } 100%{ transform: skewX(16deg) translateX(320%); opacity: 0 } }

@media (prefers-reduced-motion: reduce) {
  .cta-sweeps { animation: none; }
  .cta-sweeps::after { display: none; }
}

/* Glass panel utility for auth card */
.glass-card {
  border: 1px solid transparent;
  border-radius: 16px;
  background:
    linear-gradient(to bottom, hsl(var(--background) / 0.55), hsl(var(--background) / 0.38)) padding-box,
    linear-gradient(135deg, hsl(var(--primary) / 0.28), hsl(0 0% 100% / 0.12)) border-box;
  backdrop-filter: blur(18px);
  -webkit-backdrop-filter: blur(18px);
  position: relative;
  overflow: hidden;
}
.glass-card:after {
  content: '';
  position: absolute;
  inset: -20% -10% auto -10%;
  height: 50%;
  background: radial-gradient(800px 400px at 20% 0%, hsl(var(--primary) / 0.15), transparent 60%);
  pointer-events: none;
}

/* Vertical shimmer used on the VS divider in Before/After */
@keyframes vs-sweep {
  0% { transform: translateY(-60%); }
  100% { transform: translateY(160%); }
}
.vs-connector { animation: vs-sweep 3.2s cubic-bezier(.4,0,.2,1) infinite; }
@media (prefers-reduced-motion: reduce) {
  .vs-connector { animation: none; }
}

/* Fade bottom mask for images to blend into dark bg */
.img-fade-bottom {
  /* Stronger, curved dissolve towards bottom-right */
  -webkit-mask-image:
    radial-gradient(1000px 680px at 95% 100%, #000 40%, rgba(0,0,0,0.6) 70%, transparent 95%),
    linear-gradient(to bottom, #000 52%, rgba(0,0,0,0.55) 72%, transparent 100%);
  mask-image:
    radial-gradient(1000px 680px at 95% 100%, #000 40%, rgba(0,0,0,0.6) 70%, transparent 95%),
    linear-gradient(to bottom, #000 52%, rgba(0,0,0,0.55) 72%, transparent 100%);
}

/* Glossy bullet with sweeping light (for solution section list) */
.bullet-glow {
  position: relative;
  background: radial-gradient(60% 60% at 50% 50%, hsl(var(--status-not-registered) / 0.18), rgba(255,255,255,0.04) 70%);
  border: 1px solid rgba(255,255,255,0.14);
  box-shadow: 0 0 6px hsl(var(--status-not-registered) / 0.22);
}

@keyframes bullet-sheen {
  0% { transform: translateX(-160%) skewX(-18deg); opacity: 0; }
  15% { opacity: .85; }
  100% { transform: translateX(160%) skewX(-18deg); opacity: 0; }
}
.bullet-sheen-line {
  position: absolute; top: -30%; bottom: -30%; left: -60%; width: 52%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
  border-radius: 9999px; pointer-events: none;
  animation: bullet-sheen 3.2s cubic-bezier(.4,0,.2,1) infinite;
}
